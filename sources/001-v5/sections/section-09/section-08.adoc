[[toc9_08]]
=== 地下埋設物における特記事項

地下埋設物モデルにおいて、標準製品仕様書に記載の事項を一部変更して運用する。

変更される事項について、下記に示す。

[[toc9_08_01]]
==== 空間参照系

地下埋設物モデルは、以下の空間参照系のいずれかを適用する。平面直角座標系を推奨とするが、広域な地下埋設物モデルを整備する場合においては、経緯度座標系を使用してもよい。

include::../../../common/sections/com_9_08_P_06_001.adoc[]

////
[cols="1a,9a"]
|===
^| 次元数 ^| 空間参照系の名称

^| 3 | 日本測地系2011における平面直角座標系と東京湾平均海面を基準とする標高の複合座標参照系
^| 3 | 日本測地系2011における経緯度座標系と東京湾平均海面を基準とする標高の複合座標参照系

|===
////

[[toc9_08_02]]
==== ファイル単位

===== ファイル単位

ファイル単位は、「<<gsi_ops,作業規程の準則　付録７　公共測量標準図式>>　第84条」において定められた国土基本図の図郭とする。

また、一つのファイルには、同一の空間参照系のオブジェクトのみを含む。国土基本図の図郭は、地図情報レベル2500（一辺の長さ南北1.5㎞、東西2㎞）とする。

===== ファイルサイズとファイル分割

1ファイルのデータ量の上限は最大1GBとする。1ファイルのデータ量が1GBを超える場合は、ファイルを分割する。分割したファイルは、同じ図郭を重複して含んではならない。

[cols="2a,3a"]
.ファイル分割ルール
|===
h| 基本となるファイル単位 h| 分割ルール
| 国土基本図の図郭（地図情報レベル2500） | ファイルサイズが上限を超える場合は、上限を超えるファイルのみを分割する。 +
国土基本図の図郭（地図情報レベル500）に分割する。

|===

[[toc9_08_03]]
==== 境界線上の地物の取り扱い

===== ファイルの境界線上に存在する地物

ファイル単位となる国土基本図の図郭の境界線上に存在する地物は分割しない。

複数の図郭に跨って存在する地物は、それぞれの図郭に平面投影した形状が含まれる面積又は延長の割合を算出し、この割合が最も大きい図郭に対応するファイルに含む。

面積又は延長は、小数点2桁（3桁目で四捨五入、単位はm2又はm）で比較する。面積又は延長が同じ場合は、<<gsi_ops,付録７ 公共測量標準図式>>　第84条第4項が定める国土基本図の図郭の区画名の若い方（左上）とする。

===== 行政区域の境界線上に存在する地物

データセットの単位となる行政区域の境界線に跨って存在する地物は、分割しない。 +
複数の行政区域に跨って存在する地物は、それぞれの都市のデータセットに含めることを基本とする。

[[toc9_08_04]]
==== ファイル名称

ファイル名称（拡張子を除いた部分）は、``[図郭コード]\_[地物型]_[CRS]_[オプション]``とする。

[cols="1a,2a,2a"]
.ファイル名の構成要素
|===
h| ファイル名称の構成要素 h| 説明 h| 使用可能な文字

| `[図郭コード]`
| ファイル単位となる国土基本図の図郭の区画名
| 半角英数字

| `[地物型]`
| 格納された地物の種類を示す接頭辞
| 半角英数字

| `[CRS]`
| 格納された地物に適用される空間参照系
| 半角数字

| `[オプション]`
| 必要に応じてファイルを細分したい場合の識別子（オプション）
| 半角英数字。区切り文字を使用したい場合は半角のハイフンのみ。

| `_`
| ファイル名称の構成要素同士の区切り文字
| ファイル名称の構成要素同士を区切る場合には、アンダースコア（ `_` ）のみを用いる。
ファイル名称の構成要素の中を区切る場合は、ハイフン（ `-` ）を用いる。いずれも半角とする。

|===

``[図郭コード]``は、ファイルの単位に対応する国土基本図の図郭の区画名とする。ファイルを分割した場合は、最も若い（左上）の図郭のコードを付与する。 +
``[地物型]``にはファイルに含まれる応用スキーマを識別する接頭辞（<<tab-7-4>>）を付与する。

[cols="a,a"]
.接頭辞
|===
| 応用スキーマ | 接頭辞

| 地下埋設物モデル | unf

|===

``[CRS]``には、当該ファイルに含まれるオブジェクトの空間参照系の略称（半角数字）として
EPSGコード（ https://epsg.org/home.html[https://epsg.org/home.html] ）を入力する。
EPSGコードは、空間参照系に与えられた固有の識別子である。 +
地下埋設物に適用する空間参照系の略称を下表に示す。

[cols="a,a"]
.空間参照系の略称
|===
| オブジェクトに適用される空間参照系 | 略称

| 日本測地系2011における平面直角座標系と東京湾平均海面を基準とする標高の複合座標参照系

a| 下記のいずれかのコードを使用する。 +
10162 +
10163 +
10164 +
10165 +
10170 +
10166 +
10167 +
10168 +
10169 +
10170 +
10171 +
10172 +
10173 +
10174

|===

なお、「日本測地系2011における平面直角座標系と東京湾平均海面を基準とする標高の複合座標参照系」の略称は、適用される平面直角座標系の系により、以下の通り区分されている。

[cols="^1a,^1a,^1a,^1a,^1a,^1a"]
.適用される平面直角座標系の区分
|===
| 略称 | 座標参照系 | 略称 | 座標参照系 | 略称 | 座標参照系

| 10162 | 第Ⅰ系 | 10167 | 第Ⅵ系 | 10172 | 第Ⅺ系
| 10163 | 第Ⅱ系 | 10168 | 第Ⅶ系 | 10173 | 第Ⅻ系
| 10164 | 第Ⅲ系 | 10169 | 第Ⅷ系 | 10174 | 第ⅩⅢ系
| 10165 | 第Ⅳ系 | 10170 | 第Ⅸ系 | 　 | 　
| 10166 | 第Ⅴ系 | 10171 | 第Ⅹ系 | 　 | 　
|===
//  10162：第Ⅰ系　10163：第Ⅱ系　10164：第Ⅲ系　10165：第Ⅳ系　10166：第Ⅴ系　10167：第Ⅵ系　10168：第Ⅶ系　10169：第ⅷ系　10170：第Ⅸ系　10171：第Ⅹ系　10172：第Ⅺ系　10173：第Ⅻ系　10174：第ⅩⅢ系

``[オプション]``は、メッシュ単位及び地物型単位となるファイルをさらに分割したい場合（例：ユーティリティ事業者ごとにファイルを分割する）に使用する。使用しない場合は区切り文字と共に省略する。 +
``[オプション]``を使用する場合は、オプションの文字列、適用するフォルダの名称、オプションの意味の一覧を作成する。

[cols="2a,1a,1a"]
.オプションに使用する文字列
|===
| オプション | 適用するフォルダ名 | オプションの意味

| 　 | 　 | 　

|===

[[toc9_08_05]]
==== 繰り返しオブジェクト（Implicit Geometry）

繰り返しオブジェクト（ImplicitGeometry）は、地物毎に幾何オブジェクトを作成する代替として、一つのプロトタイプモデルを作成し、そのプロトタイプモデルを複数の地物が参照する仕組みである。CityGMLでは、都市設備、単独木など、特定の地物型のみこの仕組みを使用できる。

地物毎に、どのプロトタイプモデルを使用するのか、どこに配置するのか、また、プロトタイプモデルをどう変形するのかを情報としてもつことができる。

標準製品仕様書では、埋設物モデル（LOD2）、埋設物モデル（LOD3）、埋設物モデル（LOD4）のみ繰り返しオブジェクトを使用することを可とする。

image::images/EAID_73025C5A_08FC_47ff_AB2F_C7F79CF54B41.png[]

// image::images/465.webp.png[]

===== core:ImplicitGeometry

lutaml_klass_table::../../sources/xmi/plateau_all_packages_export.xmi[name="ImplicitGeometry",template="../../sources/liquid_templates/_klass_table.liquid"]

// [cols="1a,1a,2a"]
// |===
// | 型の定義 2+| 繰り返しオブジェクト。 +
// 地物毎に幾何オブジェクトを作成する代替として、一つのプロトタイプモデルを複数の地物が参照する仕組み。
// h| 上位の型 2+| ―
// h| ステレオタイプ 2+| << Type >>
// 3+h| 自身に定義された属性
// h| 属性名 h| 属性の型及び多重度 h| 定義
// | core::libraryObject | xs:anyURI[0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルの所在を示すURI。 +
// この属性が記述されていない場合、core:relativeGMLGeometryを必須とする。
// | core:mimeType | gml:CodeType[0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルのファイル種類。コードリスト（ImplicitGeometry_mimeType.xml）より選択する。
// | core:transformationMatrix | core:TransformationMatrix4x4[0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルの変形パラメータ。
// 3+h| 自身に定義された関連役割
// h| 関連役割名 h| 関連役割の型及び多重度 h| 定義
// | core:relativeGMLGeometry | gml::_Geometry[0..1] | 繰り返しオブジェクトで使用するプロトタイプモデル。GML形式で記述する場合に必須とする。 +
// この関連役割が記述されていない場合、core:libraryObjectを必須とする。
// | core:referencePoint | gml:Point[1] | 繰り返しオブジェクトの原点（0,0,0）を配置する参照点。3D都市モデルに適用される測地座標で記述する。
// 
// |===

===== core:TransformationMatrix4x4

lutaml_klass_table::../../sources/xmi/plateau_all_packages_export.xmi[name="TransformationMatrix4x4",template="../../sources/liquid_templates/_klass_table.liquid"]

// [cols="1a,1a,2a"]
// |===
// | 型の定義 2+| 繰り返しオブジェクトで使用するプロトタイプモデルを変形（拡大縮小、回転、平行移動）するための、3次元座標のアフィン変換行列。4×4の行列を示す16桁の数値の列からなる。
// h| 上位の型 2+| ―
// h| ステレオタイプ 2+| << DataType >>
// 3+h| 自身に定義された属性
// h| 属性名 h| 属性の型及び多重度 h| 定義
// | core:elements | xs:double [16] | 16桁の実数の列。順序をもつ。 +
// 16桁は4×4の変換行列を示し、最初の4桁は1行目、次の4桁は2行目、次の4桁は3行目、最後の4桁は4行目となる。
// 
// |===

===== ImplicitGeometry_mimeType.xml

lutaml_gml_dictionary::iur/codelists/3.2/ImplicitGeometry_mimeType.xml[template="gml_dict_template.liquid",context=dict]


===== ImplicitGeometryにより地下埋設物の形状を表現する場合の関連役割

地下埋設物の形状を、ImplicitGeometryにより表現する場合、frn:CityFurnitureから継承する関連役割を使用する。

[cols="a,a,a"]
|===
3+| 継承する関連役割

h| 関連役割名 h| 関連役割の型及び多重度 h| 定義
| frn:lod2ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD2の幾何オブジェクトの代替として使用する繰り返しオブジェクト。
| frn:lod3ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD3の幾何オブジェクトの代替として使用する繰り返しオブジェクト。
| frn:lod4ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD4の幾何オブジェクトの代替として使用する繰り返しオブジェクト。

|===

