[[toc4_01]]
=== はじめに

[[toc4_01_01]]
==== 標準製品仕様書が対象とする地物とLOD

CityGMLには、LOD0からLOD4までの五つのLODの段階が用意されている。標準製品仕様書では、地物型ごとに、対象とするLOD、各LODにおける都市オブジェクトの幾何の表現及び使用可能な地物型を定めている。

標準製品仕様書で定める地物型とその地物型が対象とするLODを<<tab-4-1>>に示す。

[[tab-4-1]]
[cols="5a,^3a,^3a,^3a,^3a,^3a"]
.標準製品仕様書が対象とするLOD
|===
| LOD | LOD0 | LOD1 | LOD2 | LOD3 | LOD4

| 建築物 | 〇 | 〇 | 〇 | 〇 | 〇
| 交通（道路） | 〇 | 〇 | 〇 | 〇 |
| 交通（徒歩道） | 〇 | 〇 | 〇 | 〇 |
| 交通（広場） | 〇 | 〇 | 〇 | 〇 |
| 交通（鉄道） | 〇 | 〇 | 〇 | 〇 |
| 交通（航路） | 〇 | 〇 | 〇 | |
| 都市計画決定情報 |  | 〇 |  |  |
| 土地利用 |  | 〇 |  |  |
| 災害リスク |  | 〇 |  |  |
| 都市設備 | 〇 | 〇 | 〇 | 〇 |
| 植生 | 〇 | 〇 | 〇 | 〇 |
| 水部 | 〇 | 〇 | 〇 | 〇 |
| 地形 | 〇 | 〇 | 〇 | 〇 |
| 橋梁 | 〇 | 〇 | 〇 | 〇 | 〇
| トンネル |  〇 | 〇 | 〇 | 〇 | 〇
| その他の構造物 | 〇 | 〇 | 〇 | 〇 |
| 地下街 | 〇 | 〇 | 〇 | 〇 | 〇
| 地下埋設物 | 〇 | 〇 | 〇 | 〇 | 〇
| 区域 |  | 〇 |  |  |
| 汎用都市オブジェクト | 〇 | 〇 | 〇 | 〇 | 〇

|===

[[toc4_01_02]]
==== 3D都市モデル応用スキーマパッケージ図

===== 3D都市モデル応用スキーマとCityGML及びi-URとの関係

3D都市モデル応用スキーマは、CityGML及びi-URを引用する。さらに、CityGMLはGMLを引用し、i-URはCityGML及びGMLを引用している。

image::images/002.png[width="280"]

// image::images/002.svg[]

===== 3D都市モデル応用スキーマ

3D都市モデル応用スキーマは、これに含まれる地物型に応じて分けられた、20個のパッケージから構成する。

image::images/003.png[width="580"]

// image::images/003.svg[]

各パッケージは、CityGML及びi-URに定義されたパッケージを引用する（<<tab-4-2>>）。

[%landscape]
<<<

[[tab-4-2]]
[cols="15a,4a,4a,4a,4a,4a,4a,4a,4a,4a,4a,4a,4a,4a,4a,4a,4a",options="noheader"]
.3D都市モデルが引用するCityGML及びi-URのパッケージ
|===
.2+|

モデル

.2+| GML
13+| CityGML
2+| i-UR

| Core | Appearance | Bridge | Building | CityFurniture | CityObjectGroup | Generic | LandUse | Relief | Transportation | Tunnel | Vegetation | WaterBody | Urban Object | Urban Function
|  建築物 | ✓ | ✓ | *1 | | ✓ | | *3 | *2 | | | | | | | ✓ |
|  交通（道路） | ✓ | ✓ | *1 | | | | | *2 | | | ✓ | | | | ✓ |
|  交通（鉄道） | ✓ | ✓ | *1 | | | | | *2 | | | ✓ | | | | ✓ |
|  交通（徒歩道） | ✓ | ✓ | *1 | | | | | *2 | | | ✓ | | | | ✓ |
|  交通（広場） | ✓ | ✓ | *1 | | | | | *2 | | | ✓ | | | | ✓ |
|  交通（航路） | ✓ | ✓ | *1 | | | | | *2 | | | ✓ | | | | ✓ |
|  土地利用 | ✓ | ✓ | | | | | | *2 | ✓ | | | | | | ✓ |
|  災害リスク | ✓ | ✓ | | | | | | *2 | | | | | | ✓ | ✓ | ✓
|  都市計画決定情報 | ✓ | ✓ | | | | | *4 | *2 | | | | | | | | ✓
|  橋梁 | ✓ | ✓ | *1 | ✓ | | | | *2 | | | | | | | ✓ |
|  トンネル | ✓ | ✓ | *1 | | | | | *2 | | | | ✓ | | | ✓ |
|  その他の構造物 | ✓ | ✓ | *1 | | | | | *2 | | | | | | | ✓ |
|  都市設備 | ✓ | ✓ | *1 | | | ✓ | | *2 | | | | | | | ✓ |
|  地下埋設物 | ✓ | ✓ | *1 | | | ✓ | | *2 | | | | | | | ✓ |
|  地下街 | ✓ | ✓ | *1 | | ✓ | | | *2 | | | | | | | ✓ |
|  植生 | ✓ | ✓ | *1 | | | | | *2 | | | | | ✓ | | ✓ |
|  水部 | | | | | | | | | | | | | | | |
|  地形 | ✓ | ✓ | | | | | | *2 | | ✓ | | | | | ✓ |
|  区域 | ✓ | ✓ | | | | | | *2 | | | | | | | | ✓
|  汎用都市オブジェクト | ✓ | ✓ | | | | | | ✓ | | | | | | | |

|===

[%key]
*1:: テクスチャ画像の貼付けや表示色の設定を行う場合に引用する。

*2:: CityGMLやi-URにない地物型や属性を追加する場合に引用する。

*3:: 建築物の「階」を表現する場合に引用する。

*4:: 複数の都市計画決定情報をグループ化する場合に引用する。

[%portrait]
<<<

[[toc4_01_03]]
==== 応用スキーマクラス図の記法

3D都市モデルに必要な地物の概念構造を記述した応用スキーマ（以下、「3D都市モデル応用スキーマ」と呼ぶ）は、同じく応用スキーマであるi-UR及びCityGMLから、標準製品仕様書に設定したユースケースに必要な地物型、地物属性及び地物関連を抽出したプロファイルとして構成する。そのため、応用スキーマクラス図では、それぞれの出典を明らかにするため、以下の記法を用いる。

[[tab-4-3]]
[cols="3a,8a"]
.応用スキーマクラス図における出典の明示
|===
| 出典 | 地物型

| GML
| 接頭辞：gml +
色：緑 rgb(204, 255,204)

| CityGML
| 接頭辞：core, bldg, luse, tran, brid, tun, frn, veg, wtr, dem +
色：黄 rgb(255, 255,204)

| i-UR
| 接頭辞：uro, urf +
色：赤 rgb(255, 204, 255)

|===

応用スキーマクラス図は、UMLクラス図(ISO/IEC 19501:2005, Information technology — Open Distributed Processing — Unified Modeling Language（UML）Version1.4.2)に定められた記法に基づき、JPGISにおいて応用スキーマクラス図を記述するために抽出された記法により記述する。応用スキーマクラス図の記述に使用する記法を<<tab-4-4>>に示す。

[[tab-4-4]]
[cols="1a,4a"]
.応用スキーマクラス図の表記
|===
| 表記 | 意味

| image::images/004.webp.png[]
| クラス。 +
クラスは3段の箱により記述する。 +
1段目の箱には、ステレオタイプ（クラスの種類）とクラス名を記述する。クラス名には、<<tab-4-3>>に示す接頭辞を付ける。 +
2段目の箱には、クラスの属性を記述する。 +
3段目の箱は使用しない。 +
クラスの属性は、属性名、属性の型、属性の多重度から構成する。 +
属性の型は、属性が取る値の種類を指定する。xs:string（文字列型）のような基本的な型やgml:Solidのような幾何型、あるいは、応用スキーマで定義した別のクラスを指定できる。 +
属性の基本的な型は、<<toc4_01_05>>に定義を示す。 +
応用スキーマクラス図では、属性名の前に「＋」の記号が表示される。 +
これはUMLクラス図において、他のクラスからその属性を表示し、使用できるかどうか（可視性）を示す。 +
ただし、応用スキーマクラス図では可視性を使用しないため、無視してよい。 +
属性の多重度は、その属性が繰り返し出現可能な回数を指定する。 +
``[a..b]``のように指定し、a及びbは、a\<=j\<=bとなる任意の整数 j を意味する。``[a..a]``は、``[a]``と同じとみなす。以下のような記載方法がある。

``[0..1]``:: 0又は1
``[0..*]``:: 0 以上
``[1..*]``:: 1 以上
``[m]``:: m
``[m..n]``:: m 以上 n以下
``[m,n]``:: m 又は n

なお、属性の多重度を省略することもできる。省略された場合は、1となる。

| image::images/005.webp.png[]
| 継承。 +
元となるクラス（上位クラス）の特性を受け継ぐ新しいクラス（下位クラス）との関係を意味する。継承を実装する場合、下位クラスのインスタンス（データ）は、自分自身に定義された属性や関連役割だけではなく、上位クラスに定義された属性や関連役割もつ。 +
△が付く側（Class1）が上位クラスである。 +
なお、後述する関連とは異なり、上位クラスと下位クラスのインスタンスは、互いへの参照はもたない。あくまで、下位クラスのインスタンスが、上位クラスに定義された属性等を記述するデータ構造をもつことだけを意味する。

| image::images/006.webp.png[]
| 関連。 +
二つのクラス間に関係性があることを意味する。 +
関連役割名は、この関連における役割を示す。また、関連には多重度を指定できる。多重度は、相手のクラス1に対して関連する自分の数を記載する。 +
多重度の記法は、属性の多重度と同じである。また、多重度が省略された場合は1となる。 +
関連を実装する場合、関連役割名をつけた属性として、他方のクラスのインスタンスへの参照をもたせる。 +
関連には向きをつけることができる。向きは矢印により記述する。関連に向きが付けられた場合、参照は片方向となる。すなわち、例図の場合にはClass1のインスタンスがClass2のインスタンスへの参照ともつが、Class2のインスタンスはClass1のインスタンスへの参照をもたない。 +
CityGMLでは、地物型と幾何型との間に関連が定義されている。これにより、都市オブジェクトは幾何オブジェクトへの参照をもつことができる。例えば、道路型（tran:Road）は空間属性として面型（gml:MultiSurface）と関連をもっている。これにより、道路の形状を面として取得し、道路オブジェクトは幾何オブジェクトとして取得した面を参照できる。

| image::images/007.webp.png[]
| 集成。 +
二つのクラス間に全体と部分という関係がある関連である。全体となるクラス側に白いひし形を記述する。 +
関連役割名は、この関連における役割を示す。また、関連には多重度を指定できる。多重度は、相手のクラス1に対して関連する自分の数を記載する。 +
多重度の記法は、属性の多重度と同じである。また、多重度が省略された場合は1となる。また、向きをつけることができる。 +
集成を実装する場合、関連役割名をつけた属性として他方のクラスのインスタンスへの参照をもたせる、又は部品となるクラスのインスタンスを全体となるクラスのインスタンスの内部に記述する。 +
なお、標準製品仕様書では、集成の実装は、部品となるクラスのインスタンスを、全体となるクラスのインスタンスの内部に記述することを原則とする。部品となるクラスは、他のクラスのインスタンスから参照してもよい。 +
CityGMLでは、uro:Building（建築物）とuro:WallSurface（外壁面）との間に集成関連が定義されている。このとき、建築物が全体となり外壁面はその部品となる。

| image::images/008.webp.png[]
| 合成。 +
二つのクラス間に全体と部分という関係がさらに強固な関連である。全体となるクラス側に黒いひし形を記述する。合成は、全体となるクラスが無くなった場合に、部分となるクラスも無くなる関係に用いる。 +
関連役割名や多重度の表記は、集成と同様である。 +
合成を実装する場合、部品となるクラスのインスタンスを、全体となるクラスのインスタンスの内部に記述する。

|===

また、各クラスのステレオタイプは以下を意味する。

[cols="1a,4a"]
.応用スキーマクラス図で使用するステレオタイプ
|===
| ステレオタイプ | 説明

| << FeatureType >>
| 地物型に適用するステレオタイプ。このステレオタイプをもつクラスは、応用スキーマのパッケージ内で定義される。

[.source]
<<jpgis_2014>>

| << DataType >>
| 個々のインスタンスを区別する必要がない、値の集合となるクラスに適用するステレオタイプ。個々に区別する必要がないため、識別子をもたない。<< DataType >>のステレオタイプをもつクラスは、データ型と呼ばれ、属性の型として使用される。データ型には、あらかじめ定義された型と使用者が定義できる型とがある。あらかじめ定義された型には、基本データ型がある。

[.source]
<<jpgis_2014>>

標準製品仕様書では、地物属性のまとまりとして定義したクラスに<< DataType >>を使用する。<< DataType >>で定義されたクラスは地物の属性の型もしくは地物の部品（合成関連における部品）として使用される。

| << Type >>
| 識別子をもち、他と区別することができるオブジェクトに適用するステレオタイプ。識別子をもつため、他から参照することができる。

[.source]
<<jpgis_2014>>

標準製品仕様書では、GMLやCityGMLで定義された地物以外の型のうち、識別子（gml:id）をもつ型（例：幾何オブジェクト）に<< Type >>を使用する。

| << BasicType >>
| 値を表現するための基本的なデータ型。

[.source]
<<jpgis_2014>>

データ型のうち、あらかじめ定義された、基本データ型のことである。 +
標準製品仕様書では、GMLやCityGMLにおいて定義された、文字列型や整数型等の基本的な型から使用可能な値の範囲を狭めたデータ型に<< BasicType >>を使用する。

| << Enumeration >>
| 文字列型や整数型などの基本データ型を制限し、取りうる値のみを列挙したリストとなるクラスに適用するステレオタイプ。

[.source]
<<jpgis_2014>>

標準製品仕様書では、地物属性の定義域が固定となる場合に、定義域に含まれる値を列挙した型に<< Enumeration >>を使用する。 +
なお、<< Enumeration >>は定義域が固定されるため、拡張製品仕様書において定義域が拡張される可能性のある場合には<< Enumeration >>は使用せず、コードリスト（gml:CodeType）を使用する。

| << Union >>
| 指定したいくつかの型のうちの一つだけが選択される共用体に適用するステレオタイプ。

[.source]
<<jpgis_2014>>


標準製品仕様書では、複数の属性のうち、いずれか一つを選択して値を記述したい場合に、複数の属性を列挙した型に<< Union >>を使用する。

|===

[[toc4_01_04]]
==== 応用スキーマ文書の読み方

応用スキーマ文書では、応用スキーマクラス図に示す各クラスについて、クラスの定義及びクラスがもつ属性及び関連役割の定義を表形式で示す。表に記載する属性名、属性の型及び多重度、また、関連役割、関連役割の型（関連の相手クラス）及び多重度は、クラス図と一致する。

定義列の説明文には、属性や関連役割の定義説明に加え、該当の属性や関連役割が運用上必須であったり、標準製品仕様で使用しない旨の情報も記載する。標準製品仕様書では使用しない属性及び関連役割は、特段の注意書きが無い限り、拡張製品仕様書で使用できる。

// 属性及び関連役割のうち、標準製品仕様書では使用しない属性及び関連役割には、その属性名又は関連役割名を括弧書きとし、背景をグレーとしている。これらの属性及び関連役割は、特段の注意書きが無い限り、拡張製品仕様書で使用できる。 +
なお、応用スキーマ文書では、具象型（インスタンスを作成できる型）のみを示す。抽象型（インスタンスを作成できない型）の定義は省略するが、抽象型から継承する属性や関連役割は、継承する属性又は継承する関連役割として示す。

[cols="1a,1a,2a"]
.定義文書の構成
|===
h| クラスの定義 2+| クラスの定義を記載。
h| 上位の型 2+| クラスが他のクラスを継承している場合、上位のクラスの名称を記載する。
h| ステレオタイプ 2+| クラスのステレオタイプを記載する。
3+h| 継承する属性
h| 属性名 h| 属性の型及び多重度 h| 定義
| 継承する属性の名称 +
``[継承元のクラス名称]`` | 属性の型と多重度 +
多重度は以下のように記載する。

``[1]``:: 必ず1
``[0..1]``:: 0又は1
``[0..*]``:: 0以上
``[1..*]``:: 1以上

| 上位クラスに定義され、このクラスが継承する属性の定義。 +
運用上必須であったり、標準製品仕様で使用しない場合は、説明を記載する。

3+h| 自身に定義された属性
h| 属性名 h| 属性の型及び多重度 h| 定義
| 自身に定義された属性の名称 +
``[自身のクラス名称]`` | 属性の型と多重度 | 自身に定義された属性の定義。 +
運用上必須であったり、標準製品仕様で使用しない場合は、説明を記載する。

3+h| 継承する関連役割
h| 関連役割名 h| 関連役割の型及び多重度 h| 定義
| 継承する関連役割の名称 +
``[継承元のクラス名称]`` | 関連の相手クラスと多重度 | 上位クラスに定義され、このクラスが継承する関連役割の定義。 +
運用上必須であったり、標準製品仕様で使用しない場合は、説明を記載する。


3+h| 自身に定義された関連役割
h| 関連役割名 h| 関連役割の型及び多重度 h| 定義
| 自分自身に定義された関連役割の名称 +
``[自身のクラス名称]`` | 関連の相手クラスと多重度 | 関連役割の定義。 +
運用上必須であったり、標準製品仕様で使用しない場合は、説明を記載する。

|===

////
[cols="1a,1a,2a"]
.定義文書の構成
|===
h| クラスの定義 2+| クラスの定義を記載。
h| 上位の型 2+| クラスが他のクラスを継承している場合、上位のクラスの名称を記載する。
h| ステレオタイプ 2+| クラスのステレオタイプを記載する。
h| 継承する属性 2+h|
h| 属性名 h| 属性の型及び多重度 h| 定義
| 継承する属性の名称 | 属性の型と多重度 +
多重度は以下のように記載する。

``[1]``:: 必ず1
``[0..1]``:: 0又は1
``[0..*]``:: 0以上
``[1..*]``:: 1以上

| 上位クラスに定義され、このクラスが継承する属性の定義。

h| 自身に定義された属性 2+h|
h| 属性名 h| 属性の型及び多重度 h| 定義
| 自身に定義された属性の名称 | 属性の型と多重度 | 自身に定義された属性の定義。
h| (使用しない属性の名称)
|
| CityGMLやi-URで定義済みの属性のうち、標準製品仕様書で使用しない属性は、属性名称に括弧を付けている。 +
特段の注意書きがない限り、拡張製品仕様書で必要に応じて使用できる。

3+h| 継承する関連役割
h| 関連役割名 h| 関連役割の型及び多重度 h| 定義
| 継承する関連役割の名称 | 関連の相手クラスと多重度 | 上位クラスに定義され、このクラスが継承する関連役割の定義。
h| (使用しない関連役割の名称)
|
| CityGMLやi-URで定義済みの関連役割のうち、標準製品仕様書で使用しない関連役割は、関連役割名称に括弧を付けている。 +
特段の注意書きがない限り、拡張製品仕様書で必要に応じて使用できる。

h| 自身に定義された関連役割 h| h|
h| 関連役割名 h| 関連役割の型及び多重度 h| 定義
| 自分自身に定義された関連役割の名称 | 関連の相手クラスと多重度 | 関連役割の定義。

|===
////


継承する属性や、継承する関連役割の表示順は、継承元のクラスごととなる。また、クラス、属性及び関連役割には、それらが定義されたパッケージの接頭辞を付す。

[[toc4_01_05]]
==== 基本的なデータ型

地物属性の型（値の種類）として使用される基本的なデータ型の定義を示す。4.2以降で示す、各応用スキーマにおいて特段記載のない場合には、本項に示す定義及び定義域（属性の値が取りうる範囲）を適用する。

[[toc4_01_05_01]]
===== 文字列型（xs:string）

漢字、平仮名、カタカナ、数字、アルファベット及び記号により構成される任意の文字列に使用する。漢字、平仮名及びカタカナは全角、数字、アルファベット及び記号は半角を基本とする。

ただし、原典資料において半角のカタカナ、全角の数字・アルファベットが使用されており、これとの一致が必要となる場合には、この限りではない。値が不明な場合は「Null」を入力する。

[[toc4_01_05_02]]
===== コード型（gml:CodeType）

指定されたコードリストに定義されたコード又は任意の文字列のいずれかの値をとる。

標準製品仕様書では、コードにより記述する場合は、参照すべきコードリストの名称を示す。また、文字列により記述する場合は文字列で入力することを示す。コードにより記述する場合で、値が不明な場合はコードリストに定義された不明を示すコードを選択する。

文字列により記述する場合で、値が不明な場合は文字列で「Null」を入力する。

[[toc4_01_05_03]]
===== 真偽値（xs:boolean）

true、false又は1、0のいずれかの値をとる。不明な場合はデータを作成しない。

[[toc4_01_05_04]]
===== 日付型（xs:date）

JIS X0301により定義された暦日付により、拡張形式による完全表記（YYYY-MM-DD）を用いて記述する。ここで、YYYYは暦年、MMは暦月、DDは暦日を示す。暦年は4桁、暦月は2桁、暦日は2桁の半角数字で記述する（1桁日や1桁月は、01、02のように0を付ける。）

年が分かるが月日が分からない場合は、YYYY-01-01とする。また、年月が分かるが日が分からない場合は、YYYY-MM-01とする。年月日が不明な場合は0001-01-01とする。

[[toc4_01_05_05]]
===== グレゴリオ年型（xs:gYear）

グレゴリオ暦による年を4桁の半角数字で記述する。値が不明な場合は0001とする。

[[toc4_01_05_06]]
===== 整数型（xs:integer）、非負整数型（xs:nonNegativeInteger）

整数の値を記述する。非負整数型の場合は、正の整数のみを可とする。

整数型の値が不明な場合は-9999とする。非負整数型の値が不明な場合は9999とする。

[[toc4_01_05_07]]
===== 実数型（xs:double）

計測により新規に取得する場合には、小数点1桁とする（小数点2桁目を四捨五入）。原典資料から取得する場合には、原典資料の記載に一致させる。値が不明な場合は-9999とする。

[[toc4_01_05_08]]
===== 単位付き計測値型（gml:MeasureType, gml:LengthType）

uom属性を用いて、数値の単位を記載する。原則として、長さの単位はm、面積の単位はm2、時間の単位はhour（時間）とする。

計測により新規に取得する場合には、小数点1桁とする（小数点2桁目を四捨五入）。ただし、原典資料において小数点2桁目以降の記載があり、これとの一致が必要となる場合には、この限りではない。

値が不明な場合は-9999とする。このときの単位は、属性ごとに指定された単位とする。

[[toc4_01_05_09]]
===== 単位付き数値又はNull値リスト型（gml:MeasureOrNullListType）

単位付き数値又はNull値とする。uom属性を用いて、数値の単位を記載すること。使用する単位は<<toc4_01_05_08>>と同じとする。

Null値は、以下の定義域より選択する。

[cols="a,a",options="unnumbered"]
|===
| Null値の定義域 | 説明

| inapplicable | データ無
| missing | 欠測
| template | 追って提供
| unknown | 不明
| withheld | 保留

|===

===== 識別子型（xs:anyURI）

任意のURI(Universal Resource Identifier)。httpsによる指定を原則とする。値が不明な場合は、「Null」と入力する。

===== エンベロープ型（gml:Envelope）

任意の次元で対向する角となる一対の位置（最小となる座標値と最大となる座標値）を用いて、矩形により範囲を定義する型。srsName属性とsrsDimension属性をもつことができる。srsName属性は、座標に使用される空間参照系を指定する。また、srsDimension属性は、座標の次元数を指定する。

