
[[sec_9]]
== その他

[[sec_9.1]]
=== データ取得

本来、製品仕様とは、成果物（3D都市モデル）が製品仕様に示された品質要求を満たしていれば、その過程（作成手法、原典資料）は問わないが、作成した3D都市モデルが国際標準に準拠したものとなるよう、データ取得についても規定する。

標準製品仕様に規定する地物の取得は、「3D都市モデル標準作業手順書」[1]に従う。

[[sec_9.2]]
=== 製品仕様のプロファイル

標準製品仕様を拡張（標準製品仕様に地物や地物属性・地物関連役割を追加）や制限（標準製品仕様を制限し、その一部を使用）することができる。

標準製品仕様の拡張又は制限においては、以下に示す規則に従う。

[[sec_9.2.1]]
==== 拡張規則

標準製品仕様に定義されていない地物や地物属性・地物関連役割を用いたい場合は、以下に示す規則に従う。

規則1:: 標準製品仕様に定義されておらず、i-URに定義されている地物又は地物属性・地物関連を使用したい場合は、i-URから必要な要素を抽出し、i-URの定義と矛盾なく使用する。

規則2:: 標準製品仕様に定義されておらず、CityGMLに定義されている地物又は地物属性・地物関連を使用したい場合は、CityGMLから必要な要素を抽出し、CityGMLの定義と矛盾なく使用する。

規則3:: 標準製品仕様に定義されておらず、i-UR及びCityGMLのいずれにも定義されていない地物を使用したい場合には、CityGMLに定義されたgen:GenericCityObjectを使用して、地物を追加する。

注記:: i-UR又はCityGMLに該当する地物が存在する場合には、gen:GenericCityObjectを使用してはならない。

規則4:: 標準製品仕様、i-UR、又はCityGMLのいずれにも定義されていない地物属性を使用したい場合には、CityGMLに定義されたgen:_genericAttributeの下位型を使用して、これを該当する地物に追加する。

注記1::: 標準製品仕様、i-UR又はCityGMLに該当する属性が存在する場合には、gen:_genericAttributeを使用してはならない。

注記2::: 「建築物」にコード型の地物属性を追加したい場合には、「建築物」に定義された「拡張属性」の仕組みを利用し、コード型の地物属性を追加する。

規則5:: 規則1、2又は規則4に従い、地物属性を追加する場合において、コード型の属性を定義する場合には、必ず、参照すべきコードリストを作成しなければならない。

注記::: コードリストの形式は、GML 3.1.1 simple dictionary profile (1.0.0)に従う。

規則6:: 規則1から規則5までに示す拡張規則に従い、標準製品仕様を拡張する場合には、拡張の内容を示す製品仕様を作成しなければならない。

注記::: 製品仕様の作成においては、地理空間データ製品仕様書作成マニュアル[4]に従うこと。

[[sec_9.2.2]]
==== 制限規則

規則1:: 標準製品仕様に定められた地物、属性又は関連を使用しない場合には、応用スキーマクラス図及び応用スキーマ文書修正は行わない。標準製品仕様書に使用する地物、属性及び関連の一覧を付与し、制限の内容を示す製品仕様を作成しなければならない。

[[sec_9.3]]
=== XMLSchemaの多重度と運用上の多重度についての留意事項

3D都市モデルの符号化仕様として、CityGML及びi-URにおいて策定されたXMLSchemaを採用している。そのため、これらのXMLSchemaに定義されたタグ及びその多重度に従う必要がある。

この時、CityGMLは汎用的な利用が想定されていることから、全ての地物あるいは属性に対応するタグの出現回数が、XMLSchema上では全て [0..1]又は[0..\*]というように設定されている。これは、いずれの地物あるいは属性を示すタグがデータ集合に出現してもしなくてもよいことを意味する。

しかしながら、3D都市モデルの整備や利用を推進するにあたり、その運用上、特定のタグの出現を必須（多重度[1]）としたり、あるいは出現を禁止（多重度[0]）としたり、出現回数を制限したい場合がある。例えば、bldg:Building（建築物）のuro:buildingIDAttribute（建築物識別属性）は、XMLSchema上は多重度が[0..\*]となるが、3D都市モデル上で建築物を識別するための情報となるため、多重度を[1]としたい場合がこれに該当する。

標準製品仕様に示す応用スキーマ（UMLクラス図及び定義文書）では、3D都市モデルとして必要な運用上の多重度を示している。データ製品の実装においては、応用スキーマとの一致（運用上の多重度との一致）が必要となることに留意すること。

なお、応用スキーマの多重度とXMLSchemaに定義された多重度との一覧を別表「応用スキーマとXMLSchemaとの多重度の対応」（ https://www.mlit.go.jp/plateau/file/libraries/doc/specification_attachedTable1.xlsx）に示す。両者に差異がある場合には、併せてその内容を留意事項として示す。

[[sec_9.4]]
=== データ利用時の留意事項

[[sec_9.4.1]]
==== XMLSchemaタグの日本語表記

　本標準製品仕様書に示す応用スキーマクラス図に示すクラスの名称や属性・関連役割の名称には、CityGML及びi-URのXMLSchemaに定義されたタグを使用している。このタグに対応する日本語表記を別表「応用スキーマとXMLSchemaとの多重度の対応」（ https://www.mlit.go.jp/plateau/file/libraries/doc/specification_attachedTable1.xlsx）に示す。

　この日本語表記は3D都市モデルの可視化において使用できる。ユースケースによって最適な可視化方法は異なるため、別表の日本語表記の採用は必須ではないが、ユースケースの実現に支障のない範囲でこの日本語表記を採用することが望ましい。

[[sec_9.4.2]]
==== 不明な値の表記

　本標準製品仕様書では、都市計画決定情報モデルの属性notificationNumber（当初の告示番号）、custodian（都市計画を定める者の名称）及びvalidFrom（当初の告示日）について、値が不明な場合の対応を以下の通り指定している。

* notificationNumber、custodian ：不明な場合は「Null」とする。
* validFrom ：不明な場合は「0001-01-01」とする。

　3D都市モデルの可視化では、これらの属性が「Null」又は「0001-01-01」の値を取る場合に「不明」又はこれに相当する値を表示する。

[[sec_9.5]]
=== 品質評価ツール

品質評価については、関連するオープンソースソフトウェアがProject "PLATEAU"公式GitHubリポジトリに公開されており、それらを利用しても良い（ https://github.com/Project-PLATEAU/）。

ただし、この品質評価ツールは、3D都市モデル標準製品仕様書第2.3版に対応しており、この標準製品仕様書が発行される時点では、この標準製品仕様書には対応していないことに留意する必要がある。

品質評価ツールは主に全数・自動検査により実施可能な品質要求を対象としている。

[[table_9-1]]
.品質評価ツールと品質要求との対応
[cols="8",options="noheader"]
|===
h|  h|  h| 品質評価尺度 h| 機能概要 h| 検査対象 h| 論理検査 h| 全数 h| 補足

| 過剰 | C01 | インスタンスに与えられたgml:idと同じgml:idをもつ他のインスタンスがデータ製品内に存在しない | カウント、数を出力 | 〇 | 〇 | 〇 |
| 漏れ | C02 | 参照データとインスタンス数が等しい | 都市モデルの数をカウントして表示、ユーザが保持する参照データの数と比較 | 〇 | 〇 | 〇 | 論理検査の結果を、目視で比較
| 書式一貫性 | L01 | 整形式（Well-Formed XML)になっていない箇所数 | XML文法チェック | 〇 | 〇 | 〇 |
.2+| 概念一貫性 | L02 | 妥当（Valid）なXML文書になっていない箇所数 | CityGML/i-URスキーマチェック | 〇 | 〇 | 〇 |
| L03 | 応用スキーマに定義していない地物型の出現箇所数 | CityGML/i-UR未定義のクラスをカウント | 〇 | 〇 | 〇 | 他スキーマが読み込まれた場合、当該クラスは排除不可
| 　 | L-bldg-06 | 建築物のbldg:lod2Solidにより記述される立体（gml:Solid）の境界面（gml:MultiSurface）と、bldg:boundedByにより参照する屋根面、底面、壁面、外部天井、外部床面又は閉鎖面がbldg:lod2MultiSurfaceにより記述される面（gml:MultiSurface）とが一致する。 | Solidを構成する面が正しいBoundarySurfaceを参照しているかチェック | 〇 | 〇 | 〇 |
.3+| 定義域一貫性 | L04 | codeSpaceにより指定された辞書に定義されていない値となっている箇所数 | カウント、数を出力 | 〇 | 〇 | 〇 |
| L05 | srsNameにより指定された空間参照系のepsgコードが、6697あるいは6668のいずれでもない。 | カウント、数を出力 | 〇 | 〇 | 〇 |
| L06 | 幾何オブジェクトインスタンスの座標値に含まれる、緯度、経度、標高が、この幾何オブジェクトインスタンスを含む都市モデル（core:CityModel）の属性boundedByにより示された空間範囲に含まれる。 | カウント、数を出力 | 〇 | 〇 | 〇 |
.2+| 位相一貫性 | L10 | 座標列の向きが不正なインスタンスをエラーとする。外周は反時計回り、内周は時計回りがただしい。 | カウント、数を出力 | 〇 | 〇 | 〇 | 対象はSolidのみ
a| L11 +
L12
| gml:Polygonの境界を構成する全ての座標値が同一平面上になければならない。同一平面上にない座標値が存在するインスタンスをエラーとする。 | カウント、数を出力 | 〇 | 〇 | 〇 | 対象はSolidのみ
.2+| | L13 | gml:Polygonに内周が存在する場合に、以下に示す条件に1つ以上に合致する場合にエラーとする。 1．内周が外周と交差している。 2．内周と外周が接することにより、gml:Polygonが2つ以上に分割されている。 3．内周同士が重なったり、包含関係にあったりする。 | カウント、数を出力 | 〇 | 〇 | 〇 | 対象はSolidのみ
| L14 | gml:Solidを構成する全ての境界面が、以下の条件を満たしていない場合にエラーとする。 1．境界面が自己交差していない。 2．閉じている。 3．全ての境界面の向きが立体の外側を向いている。 4．境界面が立体を分断していてはならない。 5．境界面が交差してはならない。 | カウント、数を出力 | 〇 | 〇 | 〇 | 対象はSolidのみ
.2+| 分類の正しさ | T03 | id参照により参照されたgml:idを与えられたインスタンスの型が、応用スキーマにおいて示された関連相手先となる型と一致しない箇所の出現回数 | Xlink先が間違った型となっていないか確認、数を出力 | 〇 | 〇 | 〇 |
| T-bldg-02 | bldg:lod2Geometryにより保持又は参照する幾何オブジェクトの型が、gml:MultiSurface又はgml:Solid、あるいはgml:CompositeSolidではないインスタンスの個数 | Pointなどが混在していないか確認、数を出力 | 〇 | 〇 | 〇 |
| | - | gen:lod0Geometryにより保持又は参照する幾何オブジェクトの型が、gml:MultiSurfaceではないインスタンスの個数 | カウント、数字を出力 | 〇 | 〇 | 〇 |

|===

[[sec_9.6]]
=== 地下埋設物における特記事項

地下埋設物モデルにおいて、標準製品仕様書に記載の事項を一部変更して運用する。

変更される事項について、下記に示す。

[[sec_9.6.1]]
==== 空間参照系

地下埋設物モデルは、以下の空間参照系のいずれかを適用する。平面直角座標系を推奨とするが、広域な地下埋設物モデルを整備する場合においては、経緯度座標系を使用してもよい。

[cols="2",options="noheader,unnumbered"]
|===
h| 次元数 h| 空間参照系の名称

| 3 | 日本測地系2011における平面直角座標系と東京湾平均海面を基準とする標高の複合座標参照系
| 3 | 日本測地系2011 における経緯度座標系と東京湾平均海面を基準とする標高の複合座標参照系

|===

[[sec_9.6.2]]
==== ファイル単位

===== ファイル単位

ファイル単位は、「作業規程の準則　付録７　公共測量標準図式　第84条」において定められた国土基本図の図郭とする。 +
また、一つのファイルには、同一の空間参照系のオブジェクトのみを含む。 +
国土基本図の図郭は、地図情報レベル2500（一辺の長さ南北1.5㎞、東西2㎞）とする。

===== ファイルサイズとファイル分割

1ファイルのデータ量の上限は最大1GBとする。 +
1ファイルのデータ量が1GBを超える場合は、ファイルを分割する。分割したファイルは、同じ図郭を重複して含んではならない。

[[table_9-2]]
.ファイル分割ルール
[cols="2",options="noheader"]
|===
h| 基本となるファイル単位 h| 分割ルール

| 国土基本図の図郭（地図情報レベル2500） | ファイルサイズが上限を超える場合は、上限を超えるファイルのみを分割する。 国土基本図の図郭（地図情報レベル500）に分割する。

|===

[[sec_9.6.3]]
==== 境界線上の地物の取り扱い

===== ファイルの境界線上に存在する地物

ファイル単位となる国土基本図の図郭の境界線上に存在する地物は分割しない。 +
複数の図郭に跨って存在する地物は、それぞれの図郭に平面投影した形状が含まれる面積又は延長の割合を算出し、この割合が最も大きい図郭に対応するファイルに含む。 +
面積又は延長は、小数点2桁（3桁目で四捨五入、単位はm2又はm）で比較する。 +
面積又は延長が同じ場合は、作業規程の準則　付録７　公共測量標準図式　第84条第4項が定める国土基本図の図郭の区画名の若い方（左上）とする。

===== 行政区域の境界線上に存在する地物

データセットの単位となる行政区域の境界線に跨って存在する地物は、分割しない。

複数の行政区域に跨って存在する地物は、それぞれの都市のデータセットに含めることを基本とする。

行政区域を跨ぐ地物をデータセットに含める場合には、以下を行う。

* 拡張製品仕様書の「1.3製品の範囲」において、行政区域を跨ぐ地物の種類とその空間範囲を示す。
* 行政区域を跨ぐ地物が含まれるファイル（ファイル単位：国土基本図の図郭）のファイル名称に、「ex」を付与する。
** 「ex」は、ファイル名称の構成要素である[オプション]を使用する。

[[sec_9.6.4]]
==== ファイル名称

ファイル名称（拡張子を除いた部分）は、[図郭コード]_[地物型]_[CRS]_[オプション]とする。

[[table_9-3]]
.ファイル名の構成要素
[cols="3",options="noheader"]
|===
h| ファイル名称の構成要素 h| 説明 h| 使用可能な文字

| [図郭コード] | ファイル単位となる国土基本図の図郭の区画名 | 半角数字
| [地物型] | 格納された地物の種類を示す接頭辞 | 半角英数字
| [CRS] | 格納された地物に適用される空間参照系 | 半角数字
| [オプション] | 必要に応じてファイルを細分したい場合の識別子（オプション） | 半角英数字。区切り文字を使用したい場合は半角のハイフンのみ。
| _ | ファイル名称の構成要素同士の区切り文字 | ファイル名称の構成要素同士を区切る場合には、アンダースコア（_）のみを用いる。ファイル名称の構成要素の中を区切る場合は、ハイフン（-）を用いる。いずれも半角とする。

|===

[図郭コード]は、ファイルの単位に対応する国土基本図の図郭の区画名とする。ファイルを分割した場合は、最も若い（左上）の図郭のコードを付与する。 +
[地物型]にはファイルに含まれる応用スキーマを識別する接頭辞（<<table_7-4>>）を付与する。

[[table_9-4]]
.接頭辞
[cols="2",options="noheader"]
|===
h| 応用スキーマ h| 接頭辞

| 地下埋設物モデル | unf

|===

[CRS]には、当該ファイルに含まれるオブジェクトの空間参照系の略称（半角数字）としてEPSGコード（ https://epsg.org/home.html）を入力する。EPSGコードは、空間参照系に与えられた固有の識別子である。 +
地下埋設物に適用する空間参照系の略称を下表に示す。

[[table_9-5]]
.空間参照系の略称
[cols="2",options="noheader"]
|===
h| オブジェクトに適用される空間参照系 h| 略称

| 日本測地系2011における平面直角座標系と東京湾平均海面を基準とする標高の複合座標参照系 | 下記のいずれかのコードを使用する。 +
10162 +
10163 +
10164 +
10165 +
10170 +
10166 +
10167 +
10168 +
10169 +
10170 +
10171 +
10172 +
10173 +
10174

|===

　なお、「日本測地系 2011 における平面直角座標系と東京湾平均海面を基準とする標高の複合座標参照系」の略称は、適用される平面直角座標系の系により、以下の通り区分されている。

10162：第Ⅰ系 10163：第Ⅱ系 10164：第Ⅲ系 10165：第Ⅳ系 10166：第Ⅴ系 10167：第Ⅵ系 10168：第Ⅶ系 +
10169：第 Ⅷ系 1、10170：第Ⅸ系、0171：第 Ⅹ 系 10172：第 Ⅺ 系 10173：第 Ⅻ 系 10174：第ⅩⅢ系

　[オプション]は、メッシュ単位及び地物型単位となるファイルをさらに分割したい場合に使用する。使用しない場合は区切り文字と共に省略する。

　[オプション]を使用する場合は、オプションの文字列、適用するフォルダの名称、オプションの意味の一覧を作成する。

[[table_9-6]]
.オプションに使用する文字列
[cols="3",options="noheader"]
|===
h| オプション h| 適用するフォルダ名 h| オプションの意味

| ex | unf | 行政区域を跨ぐ地物が含まれる。

|===

[[sec_9.6.5]]
==== 繰り返しオブジェクト（Implicit Geometry）

繰り返しオブジェクト（ImplicitGeometry）は、地物毎に幾何オブジェクトを作成する代替として、一つのプロトタイプモデルを作成し、そのプロトタイプモデルを複数の地物が参照する仕組みである。CityGMLでは、都市設備、単独木など、特定の地物型のみこの仕組みを使用できる。

地物毎に、どのプロトタイプモデルを使用するのか、どこに配置するのか、また、プロトタイプモデルをどう変形するのかを情報としてもつことができる。

標準製品仕様書では、埋設物モデル（LOD2）、埋設物モデル（LOD3）、埋設物モデル（LOD4）のみ繰り返しオブジェクトを使用することを可とする。

[%unnumbered]
image::images/figure461.png.png[]

===== core:ImplicitGeometry

[cols="3",options="noheader,unnumbered"]
|===
h| 型の定義 2+| 繰り返しオブジェクト。 地物毎に幾何オブジェクトを作成する代替として、一つのプロトタイプモデルを複数の地物が参照する仕組み。

h| 上位の型 2+| ―
h| ステレオタイプ 2+| << Type >>
3+h| 自身に定義された属性
h| 属性名 h| 属性の型及び多重度 h| 定義
| core::libraryObject | xs:anyURI[0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルの所在を示すURI。 この属性が記述されていない場合、core:relativeGMLGeometryを必須とする。
| core:mimeType | gml:CodeType[0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルのファイル種類。コードリスト（ImplicitGeometry_mimeType.xml）より選択する。
| core:transformationMatrix | core:TransformationMatrix4x4[0..1] | 繰り返しオブジェクトで使用するプロトタイプモデルの変形パラメータ。
3+h| 自身に定義された関連役割
h| 関連役割名 h| 関連役割の型及び多重度 h| 定義
| core:relativeGMLGeometry | gml::_Geometry[0..1] | 繰り返しオブジェクトで使用するプロトタイプモデル。GML形式で記述する場合に必須とする。 この関連役割が記述されていない場合、core:libraryObjectを必須とする。
| core:referencePoint | gml:Point[1] | 繰り返しオブジェクトの原点（0,0,0）を配置する参照点。3D都市モデルに適用される測地座標で記述する。

|===

===== core:TransformationMatrix4x4

[cols="3",options="noheader,unnumbered"]
|===
h| 型の定義 2+| 繰り返しオブジェクトで使用するプロトタイプモデルを変形（拡大縮小、回転、平行移動）するための、3次元座標のアフィン変換行列。4×4の行列を示す16桁の数値の列からなる。

h| 上位の型 2+| ―
h| ステレオタイプ 2+| << DataType >>
3+h| 自身に定義された属性
h| 属性名 h| 属性の型及び多重度 h| 定義
| core:elements | xs:double [16] | 16桁の実数の列。順序をもつ。 16桁は4×4の変換行列を示し、最初の4桁は1行目、次の4桁は2行目、次の4桁は3行目、最後の4桁は4行目となる。

|===

===== ImplicitGeometry_mimeType.xml

[cols="2",options="noheader,unnumbered"]
|===
h| ファイル名 | ImplicitGeometry_mimeType.xml

h| ファイルURL | https://www.geospatial.jp/iur/codelists/3.0/ImplicitGeometry_mimeType.xml
h| コード h| 説明
| model/gltf+json | gltf
| model/x3d+xml | .x3db, .x3d
| model/x3d-vrml | .x3dv, .x3dvz
| model/obj | .obj

|===

===== ImplicitGeometryにより地下埋設物の形状を表現する場合の関連役割

地下埋設物の形状を、ImplicitGeometryにより表現する場合、frn:CityFurnitureから継承する関連役割を使用する。

[cols="3",options="noheader,unnumbered"]
|===
3+h| 継承する関連役割

h| 関連役割名 h| 関連役割の型及び多重度 h| 定義
| frn:lod2ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD2の幾何オブジェクトの代替として使用する繰り返しオブジェクト。
| frn:lod3ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD3の幾何オブジェクトの代替として使用する繰り返しオブジェクト。
| frn:lod4ImplicitRepresentation | core:ImplicitGeometry [0..1] | LOD4の幾何オブジェクトの代替として使用する繰り返しオブジェクト。

|===
