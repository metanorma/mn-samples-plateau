[[tocO_02]]
=== 都市設備の記述とLOD


==== 都市設備モデル

都市設備とは、都市の屋外（道路、住宅街、広場、造成地等）に設置されている、移動しない小規模な設備（例：街路灯、道路標識、交通信号機、花壇、広告板、ベンチ、境界杭、バス停）である。

[.source]
<<citygml_30_encoding>>

都市設備の記述には、CityGMLのCityFurnitureモジュールに定義された、frn:CityFurnitureを使用する。 +
標準製品仕様書では、都市設備の表現に必要な地物型等をCityGML及びi-URより抽出し、LODごとに、含むべき地物型、各地物型の空間属性の型、取得基準、取得方法及び補足を定めた「都市設備モデル」を定義する。 +
都市設備モデルのLODは、LOD0からLOD3までを対象とする。

[[tab-O-1]]
.都市設備モデルの概要
image::images/418.webp.png[]

都市設備モデル（LOD0）は、都市設備の形状を、「公共測量標準図式」に従い、点、線又は面により表現する。 +
都市設備モデル（LOD1）は、都市設備の形状を、立体で表現することを基本とする。立体の場合は、都市設備の主要な部分の上方からの正射影の外周を、一律の高さで上向きに押し出した立体（箱モデル）である。ただし、道路上のマンホールのように、他の地物の面と一体として表現されるべきものは、都市設備の外周を包含する矩形により表現する。 +
都市設備モデル（LOD2）は、航空写真等上空から取得したデータの利用を前提とした区分であり、都市設備の主要な部分の上方からの正射影の外周の形状を再現した立体とすることを基本とする。このとき、LOD1から構造物の上面形状を詳細化する。ただし、道路上のマンホールのように、他の地物の面と一体として表現されるべきものは、都市設備の主要な部分の外周を表現する。 +
都市設備モデル（LOD3）は、MMSによる点群や画像等、側面から取得したデータや図面の利用を前提とした区分であり、立体的な地物は都市設備の側面を詳細化する。また、他の地物の面と一体として表現されるべきものは、LOD2の形状よりもさらに詳細な形状が再現される。


==== 使用可能な地物型とLOD

都市設備モデルは、LODごとに使用すべき地物型やその空間属性を定めている。


[requirement]
.都市設備記述のLOD対応条件
====
[%metadata]
identifier:: /req/frn/1
subject:: 妥当な都市設備データセットの要件
description:: 都市設備の記述には、指定されたLODに対応する地物型及び空間属性を使用する。
====

都市設備の記述には、frn:CityFurnitureを使用する。 +
都市設備モデル（LOD0）では、都市設備の形状を点、線又は面として表現する。 +
都市設備モデル（LOD1）、都市設備モデル（LOD2）及び都市設備モデル（LOD3）では、都市設備の形状を面又は立体として表現する。

[[tab-O-2]]
[cols="3a,3a,^a,^a,^a,^a,6a"]
.都市設備モデルに使用する地物型と空間属性
|===
| 地物型 |  空間属性 |  LOD0 |  LOD1 |  LOD2 |  LOD3 |  適用

.5+| frn:CityFurniture | | ● | ● | ● | ● |
| uro:lod0Geometry
^| ●
|
|
|
<| 数値地形図の取得方法に従う。 +
点、線又は面とする。

| frn:lod1Geometry |  | ● |  | <| 面又は立体とする。
| frn:lod2Geometry |  |  | ● | <| 面又は立体とする。
| frn:lod Geometry |  |  |  | ● <| 面又は立体とする。

|===

[%key]
●:: 必須
■:: 条件付必須
〇:: 任意（ユースケースに応じて要否を決定してよい）

CityGMLでは、frn:CityFurnitureの空間属性としてLOD0は定義されていない。そのため、i-URにおいて定義された公共測量標準図式のための拡張であるuro:DmAttributeの属性uro:lod0Geometryを使用する。 +
uro:lod0Geometry、frn:lod1Geometry、frn:lod2Geometry及びfrn:lod3Geometryは、点、線、面、立体、あるいはそれらの集まりという様々な幾何オブジェクトを記述可能であるが、都市設備モデルでは、各LODにおいて使用可能な幾何オブジェクトを定めている。


==== 都市設備の空間属性

===== LOD0

都市設備モデル（LOD0）では、都市設備の形状を点、線又は面により表現する。このとき、都市設備オブジェクトは、都市設備モデル（LOD0）の定義に従ったものでなければならない。


[requirement]
.都市設備のLOD0形状定義
====
[%metadata]
identifier:: /req/frn/2
subject:: 妥当な都市設備データセットの要件
description:: 都市設備のLOD0の形状は、都市設備モデル（LOD0）の定義に従う。
====

都市設備モデル（LOD0）は、公共測量標準図式に従った表現となる。

===== LOD1

都市設備モデル（LOD1）では、都市設備の形状を立体で表現することを基本とする。このとき、都市設備オブジェクトは、都市設備モデル（LOD1）の定義に従ったものでなければならない。


[requirement]
.都市設備のLOD1形状定義
====
[%metadata]
identifier:: /req/frn/3
subject:: 妥当な都市設備データセットの要件
description:: 都市設備のLOD1の形状は、都市設備モデル（LOD1）の定義に従う。
====

都市設備モデル（LOD1）では、都市設備の上方からの正射影の外周を、一律の高さで上向きに押し出した立体として表現することを基本とする。ただし、道路上のマンホールのように、他の地物の面と一体として表現されるべきものは、都市設備の外周を包含する矩形又は矩形の組み合わせにより表現する。

===== LOD2

都市設備モデル（LOD2）では、都市設備の形状を、面又は立体で表現する。このとき、都市設備オブジェクトは、都市設備モデル（LOD2）の定義に従ったものでなければならない。


[requirement]
.都市設備のLOD2形状定義
====
[%metadata]
identifier:: /req/frn/4
subject:: 妥当な都市設備データセットの要件
description:: 都市設備のLOD2の形状は、都市設備モデル（LOD2）の定義に従う。
====

都市設備モデル（LOD2）では、オブジェクトは主要な部分を簡略化した立体で表現することを基本とする。ただし、道路上のマンホールのように、他の地物の面と一体として表現されるべきものは、外周を取得する。立体として取得する場合は、上空から見下ろした形状が取得される。このとき、都市設備の上面は詳細化されるが、側面は詳細化されない。そのため、上部のほうが大きな構造をもつ都市設備の場合は、下部の構造が表現できない。このような都市設備の下部の構造を表現するには、LOD3が必要となる（<<fig-O-1>>）。

[[fig-O-1]]
.上部の構造が大きい都市設備のLOD2の形状
image::images/419.webp.png[width="150"]

===== LOD3

都市設備モデル（LOD3）では、都市設備の形状を、主要な部分の外形の特徴点から構成される面又は立体として表現する。このとき、都市設備オブジェクトは、都市設備モデル（LOD3）の定義に従ったものでなければならない。 +
都市設備モデル（LOD3）は、主要な部分の接続部の表現有無によりLOD3.0及びLOD3.1に区分する。接続部とは柱に道路標識等を添加する際に用いる取り付け金具や支持金具等を指す。


[requirement]
.都市設備のLOD3形状定義
====
[%metadata]
identifier:: /req/frn/5
subject:: 妥当な都市設備データセットの要件
description:: 都市設備のLOD3の形状は、都市設備モデル（LOD3.0）又は都市設備モデル（LOD3.1）の定義に従う。
====

都市設備モデル（LOD3.1）では、都市設備を構成する主要な部分の接続部を表現するが、立体ではなく、面の集まりとして表現することを基本とする。これは立体とする場合、接続部の詳細な面が立体の境界の要件を満たすことが困難であることを考慮している。ただし、都市設備の体積を算出する等、ユースケースで必要な場合には、立体を採用できる。


==== 都市設備の主題属性

都市設備の主題属性には、あらかじめCityGML又はGMLにおいて定義された属性（接頭辞frn、gml）がある。また、標準製品仕様書では、i-URにおいて拡張された都市設備に関する詳細な情報を格納するための属性（uro:cityFurnitureDetailAttribute）、作成したデータの品質に関する情報を格納するための属性（uro:DataQualityAttribute）、都市設備の位置や識別に関する属性（uro:FacilityIdAttribute）、特定の分野における施設区分に関する属性（uro:FacilityTypeAttribute）、その分野における施設管理に必要な属性（uro:FacilityAttribute）、公共測量標準図式に従った表現に必要となる属性（uro:frnDmAttribute）を定義している。

===== frn:function

frn:functionは、都市設備の種類を区分する属性である。標準製品仕様書では、道路基盤地図情報の地物定義及び公共測量標準図式を参考に、属性functionの定義域を定めている。 +
標準製品仕様書の定義域には含まれていないが、「都市の屋外（道路、住宅街、広場、造成地等）に設置されている、移動しない小規模な設備」に該当する場合には、都市設備として記述できる。このとき、属性frn:functionの値を「その他（9000）」とし、かつ、属性uro:facilityTypeにより都市設備の種類を特定する名称を記述する。


[requirement]
.標準製品仕様書外の都市設備記述条件
====
[%metadata]
identifier:: /req/frn/6
subject:: 妥当な都市設備データセットの要件
description:: 標準製品仕様書の定義域には含まれていない都市設備は、属性frn:functionの値を「その他（9000）」とし、属性uro:facilityTypeにより都市設備の種類を特定する名称を記述する。
====

都市設備の主題属性を特定できる網羅的な原典資料は存在しない。そのため、ユースケースで必要な設備を特定し、これに特化したデータ作成を行うことが望ましい。想定される取得方法を以下に示す。

. 路基盤地図情報より得られる場合にはこれを使用する。
. 路台帳及び道路施設台帳より得られる場合にはこれを使用する。
. 記資料が得られない場合は、MMS全方位画像等を用いて判読する。

<<tocO_03_02_01>>にfrn:functionの定義域と公共測量標準図式との対応を示す。

===== uro:facilityType

uro:facilityTypeは、都市設備の種類をさらに区分するための属性である。例えば、道路標識の場合、urf:functionにより、それが規制標識であることまでは区分できる。この規制標識を、さらに重量制限や高さ制限、最高速度等、規制の対象を明らかにしたい場合には、uro:facilityTypeを用いて区分する。

===== uro:description

uro:descriptionは、uro:facilityTypeをさらに詳細化するための属性である。例えば、uro:facilityTypeを用いて区分された規制標識の「最高速度」について、指定された速度（例：時速50km）を、uro:descriptionにより記述できる。

===== 施設管理のための属性

施設管理のための属性は、港湾施設及び漁港施設、河川管理施設や公園管理施設等の施設管理に必要な情報を定義した属性である。施設管理のための属性は以下のデータ型を用いて記述する。

====== 施設分類属性（uro:FacilityTypeAttribute）

uro:FacilityTypeAttributeは、各分野で定める施設の区分を記述するためのデータ型である。CityGMLは、地物型を物体としての性質に着目して定義し、機能や用途は属性で区分している。例えば、「都市設備（frn:CityFurniture）」という地物型を定義し、bldg:functionにより「照明施設」や「交通信号機」などを区分している。これにより、都市に存在する様々な地物を、分野を問わず網羅的に、かつ、矛盾が無く表現することを目指している。一方、各分野には独自の施設の区分がある。この区分は当該分野での施設管理に必要な情報であるが、CityGMLの地物型の区分とは一致しない。そこで、これらの地物型に分野独自の区分を付与するためにこのデータ型を用いる。uro:FacilityTypeAttributeは、二つの属性をもつ。uro:classは分野を特定するための属性である。またuro:functionは、uro:classにより特定した分野における施設の区分を示す。 +
標準製品仕様書では、港湾施設、漁港施設及び公園施設については標準製品仕様書においてuro:functionの区分が示されている。その他の区分についてはuro:classへの分野の追加も含め、拡張製品仕様書において拡張できる。

====== 施設識別属性（uro:FacilityIdAttribute）

uro:FacilityIdAttributeは、施設の位置を特定する情報及び施設を識別する情報を記述するためのデータ型である。uro:FacilityIdAttributeは、施設を識別するための情報として、識別子（uro:id）や正式な名称以外の呼称（uro:alternativeName）に加え、施設の位置を示すための、都道府県（uro:prefecture）、市区町村（uro:city）及び開始位置の経緯度（uro:startLat、uro:startLong）を属性としてもつ。また、鉄道上や道路上の施設については、路線や距離標での位置特定のための属性（uro:route、uro:startPost、uro:endPost）を使用できる。 +
なお、河川管理施設の場合は、uro:FacilityIdAttributeを継承するuro:RiverFacilityIdAttributeを使用する。これにより、左右岸上での位置の情報を記述できる。

====== 施設詳細属性（uro:FacilityAttribute）

uro:FacilityAttributeは、各分野において施設管理に必要となる情報を記述するためのデータ型である。uro:FacilityAttributeは、抽象クラスであり、これを継承する具象となるデータ型に、施設の区分毎に必要となる情報を属性として定義している。 +
標準製品仕様書では、港湾施設、漁港施設及び公園施設について、細分した施設の区分ごとにデータ型を定義している。また、施設に関する工事や点検の状況や内容を記述するためのデータ型（uro:MaintenanceHistoryAttribute）を定義している。

===== 数値地形図属性（uro:consDmAttribute）

公共測量標準図式に従った形状表現を行うために必要な属性である。LOD0の幾何オブジェクトの他、数値地形図との互換性を保つために必要な情報が、属性として定義されている。

===== データ品質属性（uro:DataQualityAttribute）

使用した原典資料やそれに基づくデータの品質、また、採用したLODは、データセットのメタデータに記録できる。ただし、データセット全体に対して一つのメタデータを作成することが基本となり、個々の都市オブジェクトの品質を記録することは困難である。 +
そこで、標準製品仕様書では、個々のデータに対してデータ品質に関する情報を記述するための属性として、「データ品質属性」（uro:DataQualityAttribute）を定義している。データ品質属性は、属性としてデータ作成に使用した原典資料の地図情報レベル、その他原典資料の諸元及び精緻化したLODをもつ。 +
3D都市モデルに含まれる全ての都市設備オブジェクトは、このデータ品質属性を必ず作成しなければならない。

