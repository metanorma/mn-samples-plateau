[[tocT_03]]
=== 標準的な作業手順

各LODの幾何オブジェクトを作成する際の標準的な作業手順及び作業上の留意事項を示す。

==== 幾何オブジェクトの作成

幾何オブジェクトの作成に必要となる原典資料を<<tab-T-6>>に示す。

[[tab-T-6]]
[cols="a,a,a,a,a"]
.原典資料一覧
|===
| |  水平位置 |  水面高さ |  水底高さ |  水中構造物の形状

h| LOD0 | 以下のいずれかのデータを一つ以上使用する

* 河川基盤地図
* 都市計画基本図等のDMデータ
* 航空写真
| ― | ― | ―
h| LOD1 | 以下のいずれかのデータを一つ以上使用する

* 都市計画基本図等のDMデータ
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 基盤地図情報等のDEM
* 航空写真
* 地形モデル
| ― | ―
h| LOD2 | 以下のいずれかのデータを一つ以上使用する

* 都市計画基本図等のDMデータ
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 基盤地図情報等のDEM
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 等深線
* 航空レーザ（ALB）の点群

* マルチビーム測深の点群
| ―
h| LOD3 | 以下のいずれかのデータを一つ以上使用する

* 都市計画基本図等のDMデータ
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 基盤地図情報等のDEM
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 等深線
* 航空レーザ（ALB）の点群
* マルチビーム測深の点群
| 以下のいずれかのデータを一つ以上使用する

* 水中構造物（橋梁等）の平面図及び断面図等
* マルチビーム測深の点群

|===

NOTE: 原典資料の一覧に示す平面図、断面図等は設計時や竣工時に作成された水中構造物の外形が取得できる図面を指す。また、図面は紙出力された資料及びＣＡＤデータを含む。

===== LOD0

====== 原典資料

[[tab-T-7]]
[cols="1a,6a,3a,3a,3a"]
.LOD0の原典資料
|===
h| | 水平位置 | 水面高さ | 水底高さ | 水中構造物の形状
h| LOD0 | 以下のいずれかのデータを一つ以上使用する

* 河川基盤地図
* 都市計画基本図等のDMデータ
* 航空写真
| ― | ― | ―

|===

====== 作業手順

. 作成対象とする河川を管理する河川事務所から河川基盤地図を入手し、その中から対象河川の「河心線」を抽出する。河川基盤地図が入手できない場合は、都市計画基本図等のDMデータに含まれる水涯線から中心線を作成する、又は航空写真から現況河道の中心線を図化する。 +
湖沼は水涯線を取得し、河川中心線はその水涯線に接するように作成する。また、海岸線は、水涯線と河川区域の境界とを結ぶ線を取得する。
. a）で抽出又は作成した河川中心線を構成する頂点の順列を調整する。 +
標準製品仕様書では、頂点の順列は流下方向に一致させることが規定されている。そのため、河川中心線を構成する第1点目の頂点を流下始点とし、最終点を流下終点となるように頂点の順列を調整する。 +
流下方向が不明の河川又は湖沼若しくは海岸線であっても頂点の順列は一定の方向となるよう調整し、そのうえで属性flowDirectionをfalseとする。
+
[[fig-T-1]]
.湖沼、海岸線の作成イメージ
image::images/509.webp.png[width="300"]

===== LOD1

====== 原典資料

[[tab-T-8]]
[cols="5a,23a,23a,23a,23a"]
.LOD1の原典資料
|===
h| | 水平位置 | 水面高さ | 水底高さ | 水中構造物の形状
h| LOD1 | 以下のいずれかのデータを一つ以上使用する

* 都市計画基本図等のDMデータ
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 地形モデル
* 基盤地図情報等のDEM
* 航空写真
| ― | ―

|===

====== 作業手順

. 都市計画基本図等のDMデータから、水涯線を抽出する。
. 地形モデルを入手又は作成する。 +
地形モデルがある場合はこれを入手し、無い場合はDEMからTIN（不規則三角網）を作成する。 +
ただし、都市計画基本図等のDMデータに含まれる水涯線と地形モデル又はDEMの作成時点が異なる等、水涯線にDEMの高さを与えることができない場合は、航空写真から水涯線を三次元図化で取得する。
. a）で抽出した水涯線に、b）で作成した地形モデルを用いて高さを与える。 +
水涯線の各頂点に、地形モデルとの交点の高さを与え、高さ付きの水涯線を作成する（<<fig-T-2>>）。 +
このとき、作成された水涯線の各頂点は一律の高さではなく、それぞれ独立した高さ（地形モデルとの交点の高さ）をもつ。
+
[[fig-T-2]]
.水面に高さを付与するイメージ
image::images/510.webp.png[width="400"]

. b）で作成した水涯線を外周とするポリゴン（水面）を作成する。また、中州がある場合は、中洲を除いた面となる。
+
[[fig-T-3]]
.中州を除いた水面のイメージ
image::images/511.webp.png[width="300"]

. c）のポリゴンを基準地域メッシュ（第3次地域区画）の境界で区切る。 +
水部のインスタンスの単位は基準地域メッシュであるため、基準地域メッシュで区切る。

水部モデル（LOD1）の作成例を<<fig-T-4>>に示す。

[[fig-T-4]]
.水部モデル（LOD1）の作成例
image::images/512.webp.png[width="400"]

===== LOD2

====== 原典資料

[[tab-T-9]]
[cols="a,a,a,a,a"]
.LOD2の原典資料
|===
| | 水平位置 | 水面高さ | 水底高さ | 水中構造物の形状

h| LOD2 | 以下のいずれかのデータを一つ以上使用する

* 都市計画基本図等のDMデータ
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 基盤地図情報等のDEM
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 等深線
* 航空レーザ（ALB）の点群
* マルチビーム測深の点群
| ―

|===

====== 作業手順

. 等深線、航空レーザ（ALB）の点群又はマルチビーム測深の点群から水底のDEMを作成する。 +
DEMの格子間隔はユースケースに応じて変更してよいが、5m以下とする。湖沼の等深線は国土地理院の湖沼データ[https://www.gsi.go.jp/kankyochiri/lakedata.html]から入手できる。ただし、湖沼データの等深線の地図情報レベルは10000であるため、使用する場合はメタデータの識別情報＞空間解像度に10000を追記する。
. a）で作成した水底のDEMからTINを作成し、それを水底面とする。
. 水部モデル（LOD1）で作成した水面とb）で作成した水底面から立体を作成する。
. c）の立体を基準地域メッシュ（第3次地域区画）の境界で分割する。
. d）で分割した立体を構成する境界面を、地物型に区分する。 +
水部モデル（LOD2）は、立体を構成する境界面を区分しなければならない。水面をWaterSurface、水底面をWaterGroundSurface、基準地域メッシュ（第3次地域区画）の境界面又は作成対象範囲の境界面をWaterClosureSurfaceにそれぞれ区分する。
+
[[fig-T-5]]
.境界面の区分イメージ
image::images/513.webp.png[width="500"]

水部モデル（LOD2）の作成例を<<fig-T-6>>及び<<fig-T-7>>に示す。

[[fig-T-6]]
.水部モデル（LOD2）における水面の例
image::images/514.webp.png[width="400"]

[[fig-T-7]]
.水部モデル（LOD2）における水底の作成例
image::images/515.webp.png[width="400"]


===== LOD3

====== 原典資料

[[tab-T-10]]
[cols="a,a,a,a,a"]
.LOD3の原典資料
|===
| | 水平位置 | 水面高さ | 水底高さ | 水中構造物の形状

h| LOD3 | 以下のいずれかのデータを一つ以上使用する

* 都市計画基本図等のDMデータ
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 基盤地図情報等のDEM
* 航空写真
| 以下のいずれかのデータを一つ以上使用する

* 等深線
* 航空レーザ（ALB）の点群
* マルチビーム測深の点群
| 以下のいずれかのデータを一つ以上使用する

* 水中構造物（橋梁等）の平面図及び断面図等
* マルチビーム測深の点群

|===

====== 作業手順

. 水部モデル（LOD2）を作成する。
. マルチビーム測深の点群および水中構造物（橋梁等）の平面図及び断面図等から水中構造物の形状を取得する。
. b）で取得した形状を水部モデル（LOD2）から取り除く。
. 水中構造物と水部の境界面を、WaterGroundSurfaceとして区分する。
+
[[fig-T-8]]
.水中構造物をくりぬくイメージ
image::images/516.webp.png[width="500"]

水部モデル（LOD3）の作成例を<<fig-T-9>>に示す。

[[fig-T-9]]
.水部モデル（LOD3）作成例
image::images/517.webp.png[width="400"]


==== 作業上の留意事項

===== 水部を構成する境界面の作成単位

wtr:WaterBodyを構成するwtr:WaterSurface、wtr:WaterGroundSurface、wtr:WaterClosureSurfaceは同一種の境界面が連続する範囲は3次メッシュの単位で1つのBoundarySurfaceにする。

[[fig-T-10]]
.境界面の作成単位のイメージ
image::images/518.webp.png[width="500"]

